import{_ as G}from"./week3.70dc6bd0.js";import{c as A,_ as R}from"./client-only.77fcb457.js";import{e as q,B as D,P as J,I as B,d as L,C as E,g as d,x as F,l as w,j as a,t as h,u as e,K as M,k as i,Z as z,i as c,F as V,m as N,s as x,q as v,M as H,v as O,$ as K,r as T,a as Z}from"./entry.950a9e27.js";import{f as Q}from"./works.8b9c14c6.js";import{l as C,p as X}from"./loading.acca26de.js";import{i as $,b as Y}from"./useUploadImg.7d2a983e.js";import{t as ee,p as se}from"./processStage.bddfdb91.js";import{k as te,r as oe}from"./users.810791e2.js";import{a as ae}from"./dropdowns.e444908b.js";import"./useCustomFetch.e7fcaaf5.js";import"./fetch.6d0ababc.js";import"./cookie.68603f12.js";import"./defaultWeekImg.22b09154.js";const le={class:"col-md-6 order-md-0 order-1"},ie={class:"fs-3 mb-4"},ne={class:"mb-4"},re=a("label",{for:"stage_id",class:"form-label"},"投稿關卡＊",-1),de=a("option",{value:"",disabled:""}," 請選擇要投稿的關卡 ",-1),ce=["value"],ue={key:0,class:"text-danger small"},_e={key:0,class:"text-danger"},me={class:"mb-4"},pe=a("label",{for:"skills",class:"form-label d-block"},"使用技術＊",-1),fe=["name"],ve=["value"],ge={class:"mb-4"},be=a("label",{for:"online_url",class:"form-label"},"線上觀看連結＊",-1),ye={key:0,class:"mb-4"},he=a("label",{for:"ui_layout_online_url",class:"form-label"},"線上觀看切版連結（CodePen 或 GitHub Pages）",-1),we={class:"mb-4"},ke=a("label",{for:"file_url",class:"form-label"},"原始檔位置",-1),Ve={class:"mb-4"},xe=a("label",{for:"description",class:"form-label"},"作品描述（限制 150 字）＊",-1),Ce={class:"mb-5"},Ue=a("label",{for:"creative_commons_id",class:"form-label"},[O(" 創用 CC＊"),a("a",{href:"http://creativecommons.tw/explore",target:"_blank"},"版權說明")],-1),Ie=a("option",{value:"",disabled:""}," 請選擇版權 ",-1),Se=["value"],Ee={class:"d-flex justify-content-end"},Ne=["disabled"],We=a("span",{class:"fill material-symbols-outlined align-middle fs-2"}," expand_circle_right ",-1),Fe={class:"col-md-6 order-md-1 order-0 py-8 py-md-0"},Me=q({__name:"Create.client",props:{roleId:{},roleName:{},stages:{},tags:{},creativeCommons:{}},setup(W){const k=D(),u=W,{roleId:g,roleName:b,stages:_,tags:U,creativeCommons:I}=J(u),l=B({works_type_id:g,ui_layout_online_url:"",stage_id:"",creative_commons_id:"",tag_ids:[],online_url:"",file_url:"",description:""}),n=m=>{const s=JSON.parse(JSON.stringify(m));for(const o in s)(s[o]===null||s[o]==="")&&delete s[o];return s},r=C(async m=>{const{data:s,error:o}=await Q(m);if(o.value)throw o.value=null,new Error("投稿失敗。");g.value===1&&$.value.length>0&&await Y(s.value.id,$.value),window.scrollTo(0,0),X.usePushMessage("success","投稿結果","投稿成功！"),setTimeout(()=>{k.push("/users/record")},2e3)}),y=L(()=>{let m=!1;return _.value.filter(o=>o.id===l.stage_id).forEach(o=>{o.nowTime>=o.endTime&&(m=!0)}),m});return(m,s)=>{const o=E("VField"),p=E("VErrorMessage"),P=E("VForm");return d(),F(P,{class:"row py-md-7 px-7 text-white",onSubmit:s[9]||(s[9]=S=>e(r)(n(S)))},{default:w(({meta:S,errors:f})=>[a("div",le,[a("h1",ie," 投稿關卡 - "+h(e(b)),1),M(i(o,{id:"works_type_id",modelValue:e(l).works_type_id,"onUpdate:modelValue":s[0]||(s[0]=t=>e(l).works_type_id=t),type:"hidden",name:"works_type_id",label:"投稿 ID",disabled:""},null,8,["modelValue"]),[[z,!1]]),a("div",ne,[re,i(o,{id:"stage_id",modelValue:e(l).stage_id,"onUpdate:modelValue":s[1]||(s[1]=t=>e(l).stage_id=t),name:"stage_id",label:"投稿關卡",class:"form-select mb-2",as:"select",rules:"required",disabled:e(_).every(t=>t.status)},{default:w(()=>[de,(d(!0),c(V,null,N(e(_),t=>(d(),c(V,{key:`stage${t.id}`},[t.status?x("",!0):(d(),c("option",{key:0,value:t.id},h(t.name),9,ce))],64))),128))]),_:1},8,["modelValue","disabled"]),f.stage_id?(d(),c("p",ue,h(f.stage_id),1)):x("",!0),a("p",null,[e(y)?(d(),c("small",_e,"已超過投稿時間，此關卡為挑戰失敗")):x("",!0)])]),a("div",me,[pe,i(o,{modelValue:e(l).tag_ids,"onUpdate:modelValue":s[3]||(s[3]=t=>e(l).tag_ids=t),label:"使用技術",name:"tag_ids",rules:"required"},{default:w(()=>[(d(!0),c(V,null,N(e(U),t=>(d(),c("label",{key:t.id,name:t.name,class:v(["",{"is-invalid":f.tag_ids}])},[M(a("input",{"onUpdate:modelValue":s[2]||(s[2]=j=>e(l).tag_ids=j),type:"checkbox",class:"d-none",value:t.id},null,8,ve),[[H,e(l).tag_ids]]),a("span",{class:v(["badge rounded-pill d-inline-block me-1 py-1 px-2",{"bg-light text-info":!e(l).tag_ids.includes(t.id),"bg-info text-white":e(l).tag_ids.includes(t.id)}])},h(t.name),3)],10,fe))),128))]),_:2},1032,["modelValue"]),i(p,{name:"tag_ids",class:"invalid-feedback"})]),a("div",ge,[be,i(o,{id:"online_url",modelValue:e(l).online_url,"onUpdate:modelValue":s[4]||(s[4]=t=>e(l).online_url=t),name:"online_url",type:"text",label:"線上觀看連結",class:v(["form-control mb-2",{"is-invalid":f.online_url}]),placeholder:"https://codepen.io/...",rules:"required|url"},null,8,["modelValue","class"]),i(p,{name:"online_url",class:"invalid-feedback"})]),e(g)===1?(d(),c("div",ye,[he,i(o,{id:"ui_layout_online_url",modelValue:e(l).ui_layout_online_url,"onUpdate:modelValue":s[5]||(s[5]=t=>e(l).ui_layout_online_url=t),name:"ui_layout_online_url",label:"線上觀看切版連結",class:v([{"is-invalid":f.ui_layout_online_url},"form-control"]),type:"text",placeholder:"https://codepen.io/..",rules:"url"},null,8,["modelValue","class"]),i(p,{name:"ui_layout_online_url",class:"invalid-feedback"})])):x("",!0),a("div",we,[ke,i(o,{id:"file_url",modelValue:e(l).file_url,"onUpdate:modelValue":s[6]||(s[6]=t=>e(l).file_url=t),label:"原始檔位置",class:v([{"is-invalid":f.file_url},"form-control"]),name:"file_url",type:"text",placeholder:"https://drive.google.com/...",rules:"url"},null,8,["modelValue","class"]),i(p,{name:"file_url",class:"invalid-feedback"})]),a("div",Ve,[xe,i(o,{id:"description",modelValue:e(l).description,"onUpdate:modelValue":s[7]||(s[7]=t=>e(l).description=t),as:"textarea",class:v(["form-control",{"is-invalid":f.description}]),name:"description",label:"作品描述",rows:"5",rules:{required:!0,max:150}},null,8,["modelValue","class"]),i(p,{name:"description",class:"invalid-feedback"})]),a("div",Ce,[Ue,i(o,{id:"creative_commons_id",modelValue:e(l).creative_commons_id,"onUpdate:modelValue":s[8]||(s[8]=t=>e(l).creative_commons_id=t),name:"creative_commons_id",label:"創用 CC",class:v(["form-select mb-2",{"is-invalid":f.creative_commons_id}]),as:"select",rules:"required|numeric"},{default:w(()=>[Ie,(d(!0),c(V,null,N(e(I),t=>(d(),c("option",{key:t.id,value:t.id},h(t.name),9,Se))),128))]),_:2},1032,["modelValue","class"]),i(p,{name:"creative_commons_id",class:"invalid-feedback"})]),a("div",Ee,[a("button",{type:"submit",class:"btn text-white border-0 p-0 fs-4 fw-bold d-flex justify-content-center align-items-center",disabled:!S.valid},[We,O(" 確認投稿 ")],8,Ne)])]),a("div",Fe,[(d(),F(K(e(ee)(e(g))),{"works-id":0,images:[],"stage-id":e(l).stage_id,"edit-status":!1},null,8,["stage-id"]))])]),_:1})}}}),Te=A(Me),$e={class:"main-bg"},qe={class:"container py-5"},De={class:"row justify-content-center"},Be={class:"col-md-10 bg-white bg-opacity-25 rounded"},Xe=q({__name:"create",setup(W){const k=D(),u=B({id:2,name:"前端工程師"}),g=C(async()=>{const{data:n,error:r}=await te();if(r.value)throw r.value=null,new Error("取得投稿資訊錯誤。");if(!n.value.user_info.individual_competition)return k.push("/users");switch(n.value.user_info.individual_competition.name){case"個人組/UI設計師":u.name="UI 設計師",u.id=1;break;case"個人組/前端工程師":u.name="前端工程師",u.id=2;break;default:k.push("/user/record");break}}),b=T([]),_=T({works_types:[],stages:[],stage_schedule:[],creative_commons:[],medals:[],tags:[]}),U=C(async()=>{try{const{data:n,error:r}=await ae();if(r.value)throw r.value=null,new Error("取得投稿資料失敗。");_.value=n.value.dropdowns,b.value=se({roleId:u.id,stages:_.value.stages,stageSchedule:_.value.stage_schedule})}catch{}}),I=C(async()=>{try{const{data:n,error:r}=await oe();if(r.value)throw r.value=null,new Error("取得投稿資訊錯誤。");const s=n.value.works_list.map(o=>({works_type_id:o.works_type_id,stage:o.stage_id})).map(o=>o.stage);b.value.forEach(o=>{const p=s.indexOf(o.id);o.id===s[p]&&(o.status=!0)})}catch{}});Z(async()=>{await g(),await U(),await I()});const l=L(()=>{var n;return((n=_.value.works_types)==null?void 0:n.filter(r=>r.id===u.id)[0])||_.value});return(n,r)=>{const y=G,m=Te,s=R;return d(),c("div",$e,[a("div",qe,[i(y),a("div",De,[a("div",Be,[i(s,null,{default:w(()=>[i(m,{"role-id":e(u).id,"role-name":e(u).name,stages:e(b),tags:e(l).tags,"creative-commons":e(_).creative_commons},null,8,["role-id","role-name","stages","tags","creative-commons"])]),_:1})])])])])}}});export{Xe as default};
