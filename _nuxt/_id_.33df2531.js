import{_ as O}from"./week3.70dc6bd0.js";import{c as R,_ as A}from"./client-only.77fcb457.js";import{e as $,B as J,P as z,I as T,r as h,a as q,n as H,C as N,g as c,x as M,l as x,j as t,t as V,u as e,i as _,F as W,m as F,k as n,q as f,K,M as L,s as Q,v as B,$ as X,G as Y,d as Z}from"./entry.950a9e27.js";import{s as ee,t as se,k as oe}from"./users.810791e2.js";import{l as C,p as te}from"./loading.acca26de.js";import{t as le,p as ae}from"./processStage.bddfdb91.js";import{a as ne}from"./dropdowns.e444908b.js";import"./useCustomFetch.e7fcaaf5.js";import"./fetch.6d0ababc.js";import"./cookie.68603f12.js";import"./useUploadImg.7d2a983e.js";import"./works.8b9c14c6.js";import"./defaultWeekImg.22b09154.js";const ie={class:"col-md-6 order-md-0 order-1"},re={class:"fs-3 mb-4"},de={class:"mb-4"},ce=t("label",{for:"stage_id",class:"form-label"},"投稿關卡＊",-1),ue={class:"form-select mb-2",disabled:""},me=["value"],_e={class:"mb-4"},pe=t("label",{for:"skills",class:"form-label d-block"},"使用技術",-1),fe=["name"],ve=["value"],be={class:"mb-4"},ge=t("label",{for:"online_url",class:"form-label"},"線上觀看連結＊",-1),he={key:0,class:"mb-4"},we=t("label",{for:"ui_layout_online_url",class:"form-label"},"線上觀看切版連結（CodePen 或 GitHub Pages）",-1),ke={class:"mb-4"},ye=t("label",{for:"file_url",class:"form-label"},"原始檔位置",-1),Ve={class:"mb-4"},xe=t("label",{for:"description",class:"form-label"},"作品描述（限制 150 字）*",-1),Ce={class:"mb-5"},Ie=t("label",{for:"creative_commons_id",class:"form-label"},[B(" 創用 CC＊"),t("a",{href:"http://creativecommons.tw/explore",target:"_blank"},"版權說明")],-1),Ue=t("option",{value:"",disabled:""}," 請選擇版權 ",-1),Ee=["value"],Se={class:"d-flex justify-content-end"},De=["disabled"],Ne=t("span",{class:"fill material-symbols-outlined align-middle fs-2"}," expand_circle_right ",-1),We={class:"col-md-6 order-md-1 order-0 py-8 py-md-0"},Fe=$({__name:"Edit.client",props:{worksId:{},roleId:{},roleName:{},stages:{},tags:{},creativeCommons:{}},setup(G){const w=J(),I=G,{worksId:r,roleId:k,roleName:y,stages:u,tags:U,creativeCommons:E}=z(I),s=T({ui_layout_online_url:"",creative_commons_id:0,tags:[],online_url:"",file_url:"",description:""}),d=h(0),g=h([]),p=C(async m=>{const{data:o,error:i}=await ee(m);if(i.value)throw i.value=null,new Error("取得投稿資料失敗。");const a=o.value.works_info;a||w.push({path:"/users"}),s.ui_layout_online_url=a.ui_layout_online_url,s.creative_commons_id=a.creative_commons_id,s.tags=a.tags.map(S=>S.id),s.online_url=a.online_url,s.file_url=a.file_url,s.description=a.description,g.value=a.images});q(async()=>{var m;await p(r.value),await H(),d.value=((m=u.value[0])==null?void 0:m.id)||0});const v=m=>{const o=JSON.parse(JSON.stringify(m));for(const i in o)(o[i]===null||o[i]==="")&&delete o[i];return o},P=C(async m=>{const{error:o}=await se(r.value,m);if(o.value)throw o.value=null,new Error("編輯失敗。");window.scrollTo(0,0),te.usePushMessage("success","編輯結果","編輯成功！"),setTimeout(()=>{w.push("/users/record")},2e3)});return(m,o)=>{const i=N("VField"),a=N("VErrorMessage"),S=N("VForm");return c(),M(S,{class:"row py-md-7 px-7 text-white",onSubmit:o[7]||(o[7]=D=>e(P)(v(D)))},{default:x(({meta:D,errors:b})=>[t("div",ie,[t("h1",re," 編輯關卡 - "+V(e(y)),1),t("div",de,[ce,t("select",ue,[(c(!0),_(W,null,F(e(u),l=>(c(),_("option",{key:`stage${l.id}`,value:l.id},V(l.name),9,me))),128))])]),t("div",_e,[pe,n(i,{modelValue:e(s).tags,"onUpdate:modelValue":o[1]||(o[1]=l=>e(s).tags=l),label:"使用技術",name:"tag_ids",rules:"required"},{default:x(()=>[(c(!0),_(W,null,F(e(U),l=>(c(),_("label",{key:l.id,name:l.name,class:f(["btn btn-sm px-0",{"is-invalid":b.tag_ids}])},[K(t("input",{"onUpdate:modelValue":o[0]||(o[0]=j=>e(s).tags=j),type:"checkbox",class:"d-none",value:l.id},null,8,ve),[[L,e(s).tags]]),t("span",{class:f(["badge rounded-pill d-inline-block me-1 py-1 px-2",{"bg-light text-info":!e(s).tags.includes(l.id),"bg-info text-white":e(s).tags.includes(l.id)}])},V(l.name),3)],10,fe))),128))]),_:2},1032,["modelValue"]),n(a,{name:"tag_ids",class:"invalid-feedback"})]),t("div",be,[ge,n(i,{id:"online_url",modelValue:e(s).online_url,"onUpdate:modelValue":o[2]||(o[2]=l=>e(s).online_url=l),name:"online_url",type:"text",label:"線上觀看連結",class:f(["form-control mb-2",{"is-invalid":b.online_url}]),placeholder:"https://codepen.io/...",rules:"required|url"},null,8,["modelValue","class"]),n(a,{name:"online_url",class:"invalid-feedback"})]),e(k)===1?(c(),_("div",he,[we,n(i,{id:"ui_layout_online_url",modelValue:e(s).ui_layout_online_url,"onUpdate:modelValue":o[3]||(o[3]=l=>e(s).ui_layout_online_url=l),name:"ui_layout_online_url",label:"線上觀看切版連結",class:f([{"is-invalid":b.ui_layout_online_url},"form-control"]),type:"text",placeholder:"https://codepen.io/..",rules:"url"},null,8,["modelValue","class"]),n(a,{name:"ui_layout_online_url",class:"invalid-feedback"})])):Q("",!0),t("div",ke,[ye,n(i,{id:"file_url",modelValue:e(s).file_url,"onUpdate:modelValue":o[4]||(o[4]=l=>e(s).file_url=l),label:"原始檔位置",class:f([{"is-invalid":b.file_url},"form-control"]),name:"file_url",type:"text",placeholder:"https://drive.google.com/...",rules:"url"},null,8,["modelValue","class"]),n(a,{name:"file_url",class:"invalid-feedback"})]),t("div",Ve,[xe,n(i,{id:"description",modelValue:e(s).description,"onUpdate:modelValue":o[5]||(o[5]=l=>e(s).description=l),as:"textarea",class:f(["form-control",{"is-invalid":b.description}]),name:"description",label:"作品描述",rows:"5",rules:{required:!0,max:150}},null,8,["modelValue","class"]),n(a,{name:"description",class:"invalid-feedback"})]),t("div",Ce,[Ie,n(i,{id:"creative_commons_id",modelValue:e(s).creative_commons_id,"onUpdate:modelValue":o[6]||(o[6]=l=>e(s).creative_commons_id=l),name:"creative_commons_id",label:"創用 CC",class:f(["form-select mb-2",{"is-invalid":b.creative_commons_id}]),as:"select",rules:"required|numeric"},{default:x(()=>[Ue,(c(!0),_(W,null,F(e(E),l=>(c(),_("option",{key:l.id,value:l.id},V(l.name),9,Ee))),128))]),_:2},1032,["modelValue","class"]),n(a,{name:"creative_commons_id",class:"invalid-feedback"})]),t("div",Se,[t("button",{type:"submit",class:"btn text-white border-0 p-0 fs-4 fw-bold d-flex justify-content-center align-items-center",disabled:!D.valid},[Ne,B(" 編輯投稿 ")],8,De)])]),t("div",We,[(c(),M(X(e(le)(e(k))),{"works-id":e(r),"stage-id":e(d),images:e(g),"edit-status":!0,onGetData:e(p)},null,40,["works-id","stage-id","images","onGetData"]))])]),_:1})}}}),Ge=R(Fe),Me={class:"main-bg"},$e={class:"container py-5"},Te={class:"row justify-content-center"},qe={class:"col-md-10 bg-white bg-opacity-25 rounded"},Ye=$({__name:"[id]",setup(G){const w=Y(),I=h(parseInt(w.params.id,10)),r=T({id:2,name:"前端工程師"}),k=C(async()=>{var p,v;const{data:s,error:d}=await oe();if(d.value)throw d.value=null,new Error("取得使用者資料失敗。");if(!((v=(p=s.value)==null?void 0:p.user_info)!=null&&v.individual_competition))throw new Error("取得使用者資料失敗。");switch(s.value.user_info.individual_competition.name){case"個人組/UI設計師":r.name="UI 設計師",r.id=1;break;case"個人組/前端工程師":r.name="前端工程師",r.id=2;break}}),y=h([]),u=h({works_types:[],stages:[],stage_schedule:[],creative_commons:[],medals:[],tags:[]}),U=C(async()=>{const{data:s,error:d}=await ne();if(d.value)throw d.value=null,new Error("取得投稿資料失敗。");u.value=s.value.dropdowns,y.value=ae({roleId:r.id,stages:u.value.stages,stageSchedule:u.value.stage_schedule})});q(()=>{k(),U()});const E=Z(()=>{var s;return((s=u.value.works_types)==null?void 0:s.filter(d=>d.id===r.id)[0])||u.value});return(s,d)=>{const g=O,p=Ge,v=A;return c(),_("div",Me,[t("div",$e,[n(g),t("div",Te,[t("div",qe,[n(v,null,{default:x(()=>[n(p,{"works-id":e(I),"role-id":e(r).id,"role-name":e(r).name,stages:e(y),tags:e(E).tags,"creative-commons":e(u).creative_commons},null,8,["works-id","role-id","role-name","stages","tags","creative-commons"])]),_:1})])])])])}}});export{Ye as default};
