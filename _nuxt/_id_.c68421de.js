import{_ as j}from"./week3.70dc6bd0.js";import{c as J,_ as R}from"./client-only.77fcb457.js";import{e as G,B as A,P as z,I as q,r as w,a as W,C as D,g as c,x as $,l as y,j as l,t as k,u as e,K as F,k as i,Z as H,i as m,F as N,m as E,q as u,M as K,s as L,v as B,$ as Z,G as Q,d as X}from"./entry.950a9e27.js";import{s as Y,t as ee}from"./users.810791e2.js";import{l as M,p as se}from"./loading.acca26de.js";import{t as oe,p as te}from"./processStage.bddfdb91.js";import{a as le}from"./dropdowns.e444908b.js";import"./useCustomFetch.e7fcaaf5.js";import"./fetch.6d0ababc.js";import"./cookie.68603f12.js";import"./useUploadImg.7d2a983e.js";import"./works.8b9c14c6.js";import"./defaultWeekImg.22b09154.js";const ae={class:"col-md-6 order-md-0 order-1"},ie={class:"fs-3 mb-4"},ne={class:"mb-4"},de=l("label",{for:"stage_id",class:"form-label"},"投稿關卡＊",-1),re={class:"form-select mb-2",disabled:""},ce=["value"],_e={class:"mb-4"},me=l("label",{for:"skills",class:"form-label d-block"},"使用技術",-1),ue=["name"],pe=["value"],fe={class:"mb-4"},ve=l("label",{for:"online_url",class:"form-label"},"線上觀看連結＊",-1),ge={key:0,class:"mb-4"},be=l("label",{for:"code_link",class:"form-label"},"線上觀看切版連結（CodePen 或 GitHub Pages）",-1),ke={class:"mb-4"},we=l("label",{for:"file_url",class:"form-label"},"原始檔位置",-1),ye={class:"mb-4"},he=l("label",{for:"description",class:"form-label"},"作品描述（限制 150 字）＊",-1),Ve={class:"mb-5"},xe=l("label",{for:"creative_commons_id",class:"form-label"},[B(" 創用 CC＊"),l("a",{href:"http://creativecommons.tw/explore",target:"_blank"},"版權說明")],-1),Ce=l("option",{value:"",disabled:""}," 請選擇版權 ",-1),Ie=["value"],Se={class:"d-flex justify-content-end"},Ue=["disabled"],De=l("span",{class:"fill material-symbols-outlined align-middle fs-2"}," expand_circle_right ",-1),Ne={class:"col-md-6 order-md-1 order-0 py-8 py-md-0"},Ee=G({__name:"TeamEdit.client",props:{worksId:{},roleId:{},roleName:{},stages:{},tags:{},creativeCommons:{}},setup(T){const h=A(),V=T,{worksId:d,roleId:v,roleName:_,stages:x,tags:C,creativeCommons:r}=z(V),s=q({works_type_id:0,ui_layout_online_url:"",stage_id:"",creative_commons_id:"",tag_ids:[],online_url:"",file_url:"",description:""}),g=w([]),b=M(async p=>{const{data:o,error:n}=await Y(p);if(n.value)throw n.value=null,new Error("獲取資料失敗。");const a=o.value.works_info;s.works_type_id=a.works_types_id,s.ui_layout_online_url=a.ui_layout_online_url,s.stage_id=a.stage_id,s.creative_commons_id=a.creative_commons_id,s.tag_ids=a.tags.map(S=>S.id),s.online_url=a.online_url,s.file_url=a.file_url,s.description=a.description,g.value=a.images});W(()=>{b(d.value)});const I=p=>{const o=JSON.parse(JSON.stringify(p));for(const n in o)(o[n]===null||o[n]==="")&&delete o[n];return o},O=M(async p=>{const{error:o}=await ee(d.value,p);if(o.value)throw o.value=null,new Error("編輯失敗。");window.scrollTo(0,0),se.usePushMessage("success","編輯結果","編輯成功！"),setTimeout(()=>{h.push("/users/record")},2e3)});return(p,o)=>{const n=D("VField"),a=D("VErrorMessage"),S=D("VForm");return c(),$(S,{class:"row py-md-7 px-7 text-white",onSubmit:o[8]||(o[8]=U=>e(O)(I(U)))},{default:y(({meta:U,errors:f})=>[l("div",ae,[l("h1",ie," 投稿關卡 - "+k(e(_)),1),F(i(n,{id:"works_type_id",modelValue:e(s).works_type_id,"onUpdate:modelValue":o[0]||(o[0]=t=>e(s).works_type_id=t),type:"hidden",name:"works_type_id",label:"投稿 ID",disabled:""},null,8,["modelValue"]),[[H,!1]]),l("div",ne,[de,l("select",re,[(c(!0),m(N,null,E(e(x),t=>(c(),m("option",{key:`stage${t.id}`,value:t.id},k(t.name),9,ce))),128))])]),l("div",_e,[me,i(n,{modelValue:e(s).tag_ids,"onUpdate:modelValue":o[2]||(o[2]=t=>e(s).tag_ids=t),label:"使用技術",name:"tag_ids",rules:"required"},{default:y(()=>[(c(!0),m(N,null,E(e(C),t=>(c(),m("label",{key:t.id,name:t.name,class:u(["btn btn-sm px-0",{"is-invalid":f.tag_ids}])},[F(l("input",{"onUpdate:modelValue":o[1]||(o[1]=P=>e(s).tag_ids=P),type:"checkbox",class:"d-none",value:t.id},null,8,pe),[[K,e(s).tag_ids]]),l("span",{class:u(["badge rounded-pill d-inline-block me-1 py-1 px-2",{"bg-light text-info":!e(s).tag_ids.includes(t.id),"bg-info text-white":e(s).tag_ids.includes(t.id)}])},k(t.name),3)],10,ue))),128))]),_:2},1032,["modelValue"]),i(a,{name:"tag_ids",class:"invalid-feedback"})]),l("div",fe,[ve,i(n,{id:"online_url",modelValue:e(s).online_url,"onUpdate:modelValue":o[3]||(o[3]=t=>e(s).online_url=t),name:"online_url",type:"text",label:"線上觀看連結",class:u(["form-control mb-2",{"is-invalid":f.online_url}]),placeholder:"https://codepen.io/...",rules:"required|url"},null,8,["modelValue","class"]),i(a,{name:"online_url",class:"invalid-feedback"})]),e(v)===1?(c(),m("div",ge,[be,i(n,{id:"code_link",modelValue:e(s).ui_layout_online_url,"onUpdate:modelValue":o[4]||(o[4]=t=>e(s).ui_layout_online_url=t),name:"code_link",label:"線上觀看切版連結",class:u([{"is-invalid":f.code_link},"form-control"]),type:"text",placeholder:"https://codepen.io/..",rules:"url"},null,8,["modelValue","class"]),i(a,{name:"code_link",class:"invalid-feedback"})])):L("",!0),l("div",ke,[we,i(n,{id:"file_url",modelValue:e(s).file_url,"onUpdate:modelValue":o[5]||(o[5]=t=>e(s).file_url=t),label:"原始檔位置",class:u([{"is-invalid":f.file_url},"form-control"]),name:"file_url",type:"text",placeholder:"https://drive.google.com/...",rules:"url"},null,8,["modelValue","class"]),i(a,{name:"file_url",class:"invalid-feedback"})]),l("div",ye,[he,i(n,{id:"description",modelValue:e(s).description,"onUpdate:modelValue":o[6]||(o[6]=t=>e(s).description=t),as:"textarea",class:u(["form-control",{"is-invalid":f.description}]),name:"description",label:"作品描述",rows:"5",rules:{required:!0,max:150}},null,8,["modelValue","class"]),i(a,{name:"description",class:"invalid-feedback"})]),l("div",Ve,[xe,i(n,{id:"creative_commons_id",modelValue:e(s).creative_commons_id,"onUpdate:modelValue":o[7]||(o[7]=t=>e(s).creative_commons_id=t),name:"creative_commons_id",label:"創用 CC",class:u(["form-select mb-2",{"is-invalid":f.creative_commons_id}]),as:"select",rules:"required|numeric"},{default:y(()=>[Ce,(c(!0),m(N,null,E(e(r),t=>(c(),m("option",{key:t.id,value:t.id},k(t.name),9,Ie))),128))]),_:2},1032,["modelValue","class"]),i(a,{name:"creative_commons_id",class:"invalid-feedback"})]),l("div",Se,[l("button",{type:"submit",class:"btn text-white border-0 p-0 fs-4 fw-bold d-flex justify-content-center align-items-center",disabled:!U.valid},[De,B(" 編輯投稿 ")],8,Ue)])]),l("div",Ne,[(c(),$(Z(e(oe)(e(v))),{"works-id":e(d),"stage-id":e(s).stage_id,images:e(g),"edit-status":!0,onGetData:e(b)},null,40,["works-id","stage-id","images","onGetData"]))])]),_:1})}}}),We=J(Ee),Me={class:"main-bg"},Te={class:"container py-5"},$e={class:"row justify-content-center"},Fe={class:"col-md-10 bg-white bg-opacity-25 rounded"},Ze=G({__name:"[id]",setup(T){const h=Q(),V=w(parseInt(h.params.id,10)),d=q({id:4,name:"團體組前端"});W(()=>{const r=JSON.parse(window.localStorage.getItem("team")||"{}");d.id=parseInt(r.id,10),d.name=r.name});const v=w([]),_=w({works_types:[],stages:[],stage_schedule:[],creative_commons:[],medals:[],tags:[]}),x=M(async()=>{const{data:r,error:s}=await le();if(s.value)throw s.value=null,new Error("取得投稿資料失敗。");_.value=r.value.dropdowns,v.value=te({roleId:d.id,stages:_.value.stages,stageSchedule:_.value.stage_schedule})});W(()=>{x()});const C=X(()=>{var r;return((r=_.value.works_types)==null?void 0:r.filter(s=>s.id===d.id)[0])||_.value});return(r,s)=>{const g=j,b=We,I=R;return c(),m("div",Me,[l("div",Te,[i(g),l("div",$e,[l("div",Fe,[i(I,null,{default:y(()=>[i(b,{"works-id":e(V),"role-id":e(d).id,"role-name":e(d).name,stages:e(v),tags:e(C).tags,"creative-commons":e(_).creative_commons},null,8,["works-id","role-id","role-name","stages","tags","creative-commons"])]),_:1})])])])])}}});export{Ze as default};
