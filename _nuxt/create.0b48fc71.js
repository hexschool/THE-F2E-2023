import{_ as G}from"./week3.70dc6bd0.js";import{c as A,_ as J}from"./client-only.77fcb457.js";import{e as M,B as $,P as L,I as q,d as j,C as T,g as r,i as u,k as i,l as w,j as o,t as k,u as e,K as W,Z as R,F as V,m as N,s as x,q as g,M as z,v as B,x as H,$ as K,r as D,a as Z}from"./entry.950a9e27.js";import{f as Q}from"./works.8b9c14c6.js";import{i as F,b as X}from"./useUploadImg.7d2a983e.js";import{l as C,p as Y}from"./loading.acca26de.js";import{t as ee,p as se}from"./processStage.bddfdb91.js";import{k as te,r as oe}from"./users.810791e2.js";import{a as ae}from"./dropdowns.e444908b.js";import"./useCustomFetch.e7fcaaf5.js";import"./fetch.6d0ababc.js";import"./cookie.68603f12.js";import"./defaultWeekImg.22b09154.js";const le={class:"text-white"},ie={class:"col-md-6 order-md-0 order-1"},ne={class:"fs-3 mb-4"},de={class:"mb-4"},re=o("label",{for:"stage_id",class:"form-label"},"投稿關卡＊",-1),ce=o("option",{value:"",disabled:""}," 請選擇要投稿的關卡 ",-1),ue=["value"],me={key:0,class:"text-danger small"},_e={key:0,class:"text-danger"},pe={class:"mb-4"},fe=o("label",{for:"skills",class:"form-label d-block"},"使用技術",-1),ve=["name"],ge=["value"],be={class:"mb-4"},he=o("label",{for:"online_url",class:"form-label"},"線上觀看連結＊",-1),ke={key:0,class:"mb-4"},we=o("label",{for:"code_link",class:"form-label"},"線上觀看切版連結（CodePen 或 GitHub Pages）",-1),ye={class:"mb-4"},Ve=o("label",{for:"file_url",class:"form-label"},"原始檔位置",-1),xe={class:"mb-4"},Ce=o("label",{for:"description",class:"form-label"},"作品描述（限制 150 字）＊",-1),Se={class:"mb-5"},Ue=o("label",{for:"creative_commons_id",class:"form-label"},[B(" 創用 CC＊"),o("a",{href:"http://creativecommons.tw/explore",target:"_blank"},"版權說明")],-1),Ee=o("option",{value:"",disabled:""}," 請選擇版權 ",-1),Te=["value"],Ne={class:"d-flex justify-content-end"},Ie=["disabled"],We=o("span",{class:"fill material-symbols-outlined align-middle fs-2"}," expand_circle_right ",-1),De={class:"col-md-6 order-md-1 order-0 py-8 py-md-0"},Fe=M({__name:"TeamCreate.client",props:{roleId:{},roleName:{},stages:{},tags:{},creativeCommons:{}},setup(I){const y=$(),m=I,{roleId:_,roleName:p,stages:h,tags:S,creativeCommons:U}=L(m),a=q({works_type_id:_,ui_layout_online_url:"",stage_id:"",creative_commons_id:"",tag_ids:[],online_url:"",file_url:"",description:""}),c=n=>{const s=JSON.parse(JSON.stringify(n));for(const l in s)(s[l]===null||s[l]==="")&&delete s[l];return s},d=C(async n=>{const{data:s,error:l}=await Q(n);if(l.value)throw l.value=null,new Error("投稿失敗。");_.value===3&&F.value.length>0&&X(s.value.id,F.value),window.scrollTo(0,0),Y.usePushMessage("success","投稿結果","投稿成功！"),setTimeout(()=>{y.push("/users/record")},2e3)}),v=j(()=>{let n=!1;return h.value.filter(l=>l.id===a.stage_id).forEach(l=>{l.nowTime>=l.endTime&&(n=!0)}),n});return(n,s)=>{const l=T("VField"),b=T("VErrorMessage"),O=T("VForm");return r(),u("div",le,[i(O,{class:"row justify-content-center py-md-7",onSubmit:s[9]||(s[9]=E=>e(d)(c(E)))},{default:w(({meta:E,errors:f})=>[o("div",ie,[o("h1",ne," 投稿關卡 - "+k(e(p)),1),W(i(l,{id:"works_type_id",modelValue:e(a).works_type_id,"onUpdate:modelValue":s[0]||(s[0]=t=>e(a).works_type_id=t),type:"hidden",name:"works_type_id",label:"投稿 ID",disabled:""},null,8,["modelValue"]),[[R,!1]]),o("div",de,[re,i(l,{id:"stage_id",modelValue:e(a).stage_id,"onUpdate:modelValue":s[1]||(s[1]=t=>e(a).stage_id=t),name:"stage_id",label:"投稿關卡",class:"form-select mb-2",as:"select",rules:"required",disabled:e(h).every(t=>t.status)},{default:w(()=>[ce,(r(!0),u(V,null,N(e(h),t=>(r(),u(V,{key:`stage${t.id}`},[t.status?x("",!0):(r(),u("option",{key:0,value:t.id},k(t.name),9,ue))],64))),128))]),_:1},8,["modelValue","disabled"]),f.stage_id?(r(),u("p",me,k(f.stage_id),1)):x("",!0),o("p",null,[e(v)?(r(),u("small",_e,"已超過投稿時間，此關卡為挑戰失敗")):x("",!0)])]),o("div",pe,[fe,i(l,{modelValue:e(a).tag_ids,"onUpdate:modelValue":s[3]||(s[3]=t=>e(a).tag_ids=t),label:"使用技術",name:"tag_ids",rules:"required"},{default:w(()=>[(r(!0),u(V,null,N(e(S),t=>(r(),u("label",{key:t.id,name:t.name,class:g(["btn btn-sm px-0",{"is-invalid":f.tag_ids}])},[W(o("input",{"onUpdate:modelValue":s[2]||(s[2]=P=>e(a).tag_ids=P),type:"checkbox",class:"d-none",value:t.id},null,8,ge),[[z,e(a).tag_ids]]),o("span",{class:g(["badge rounded-pill d-inline-block me-1 py-1 px-2",{"bg-light text-info":!e(a).tag_ids.includes(t.id),"bg-info text-white":e(a).tag_ids.includes(t.id)}])},k(t.name),3)],10,ve))),128))]),_:2},1032,["modelValue"]),i(b,{name:"tag_ids",class:"invalid-feedback"})]),o("div",be,[he,i(l,{id:"online_url",modelValue:e(a).online_url,"onUpdate:modelValue":s[4]||(s[4]=t=>e(a).online_url=t),name:"online_url",type:"text",label:"線上觀看連結",class:g(["form-control mb-2",{"is-invalid":f.online_url}]),placeholder:"https://codepen.io/...",rules:"required|url"},null,8,["modelValue","class"]),i(b,{name:"online_url",class:"invalid-feedback"})]),e(_)===1?(r(),u("div",ke,[we,i(l,{id:"code_link",modelValue:e(a).ui_layout_online_url,"onUpdate:modelValue":s[5]||(s[5]=t=>e(a).ui_layout_online_url=t),name:"code_link",label:"線上觀看切版連結",class:g([{"is-invalid":f.code_link},"form-control"]),type:"text",placeholder:"https://codepen.io/..",rules:"url"},null,8,["modelValue","class"]),i(b,{name:"code_link",class:"invalid-feedback"})])):x("",!0),o("div",ye,[Ve,i(l,{id:"file_url",modelValue:e(a).file_url,"onUpdate:modelValue":s[6]||(s[6]=t=>e(a).file_url=t),label:"原始檔位置",class:g([{"is-invalid":f.file_url},"form-control"]),name:"file_url",type:"text",placeholder:"https://drive.google.com/...",rules:"url"},null,8,["modelValue","class"]),i(b,{name:"file_url",class:"invalid-feedback"})]),o("div",xe,[Ce,i(l,{id:"description",modelValue:e(a).description,"onUpdate:modelValue":s[7]||(s[7]=t=>e(a).description=t),as:"textarea",class:g(["form-control",{"is-invalid":f.description}]),name:"description",label:"作品描述",rows:"5",rules:{required:!0,max:150}},null,8,["modelValue","class"]),i(b,{name:"description",class:"invalid-feedback"})]),o("div",Se,[Ue,i(l,{id:"creative_commons_id",modelValue:e(a).creative_commons_id,"onUpdate:modelValue":s[8]||(s[8]=t=>e(a).creative_commons_id=t),name:"creative_commons_id",label:"創用 CC",class:g(["form-select mb-2",{"is-invalid":f.creative_commons_id}]),as:"select",rules:"required|numeric"},{default:w(()=>[Ee,(r(!0),u(V,null,N(e(U),t=>(r(),u("option",{key:t.id,value:t.id},k(t.name),9,Te))),128))]),_:2},1032,["modelValue","class"]),i(b,{name:"creative_commons_id",class:"invalid-feedback"})]),o("div",Ne,[o("button",{type:"submit",class:"btn text-white border-0 p-0 fs-4 fw-bold d-flex justify-content-center align-items-center",disabled:!E.valid},[We,B(" 確認投稿 ")],8,Ie)])]),o("div",De,[(r(),H(K(e(ee)(e(_))),{"works-id":0,images:[],"stage-id":e(a).stage_id,"edit-status":!1},null,8,["stage-id"]))])]),_:1})])}}}),Me=A(Fe),$e={class:"main-bg"},qe={class:"container py-5"},je={class:"row justify-content-center"},Be={class:"col-md-10 bg-white bg-opacity-25 rounded"},Ye=M({__name:"create",setup(I){const y=$(),m=q({id:4,name:"團體組前端"}),_=D([]),p=D({works_types:[],stages:[],stage_schedule:[],creative_commons:[],medals:[],tags:[]}),h=C(async()=>{const{data:c,error:d}=await oe();if(d.value)throw d.value=null,new Error("取得投稿資訊錯誤。");c.value.works_list.forEach(n=>{n.works_type_id===m.id&&_.value.forEach(s=>{s.id===n.stage_id&&(s.status=!0)})})}),S=C(async()=>{const{data:c,error:d}=await ae();if(d.value)throw d.value=null,new Error("取得投稿資訊錯誤。");p.value=c.value.dropdowns;const v=p.value.stage_schedule.filter(n=>n.works_types_id===m.id);_.value=await se({roleId:m.id,stages:p.value.stages,stageSchedule:v}),await h()}),U=C(async()=>{const{data:c,error:d}=await te();if(d.value)throw d.value=null,new Error("取得投稿資訊錯誤。");if(!c.value.user_info.team_competition||!c.value.user_info.team_competition.is_leader)return y.push("/users");const n=JSON.parse(window.sessionStorage.getItem("team")||"{}");m.id=n.id,m.name=n.name,await S()});Z(async()=>{await U()});const a=j(()=>{var c;return((c=p.value.works_types)==null?void 0:c.filter(d=>d.id===m.id)[0])||p.value});return(c,d)=>{const v=G,n=Me,s=J;return r(),u("div",$e,[o("div",qe,[i(v),o("div",je,[o("div",Be,[i(s,null,{default:w(()=>[i(n,{"role-id":e(m).id,"role-name":e(m).name,stages:e(_),tags:e(a).tags,"creative-commons":e(p).creative_commons},null,8,["role-id","role-name","stages","tags","creative-commons"])]),_:1})])])])])}}});export{Ye as default};
